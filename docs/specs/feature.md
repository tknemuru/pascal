# 4歳児向けパズルゲーム仕様

## ゲームの概要

* 未就学児を対象とした図形パズルゲームであり、子供の想像力発達を目的としたゲームである。
* iPad/Safariでの利用を想定しているPWAである。
* ユーザは与えられた図形をD&Dでターゲット枠にあてはめていく。

## 技術的制約と判定ロジック (Technical Constraints)

開発時は以下のロジック制約を厳守すること。

1. **判定ロジック (Strict Matching):**
    * 図形のドロップ判定は、単なる「衝突判定」や「包含判定」ではない。
    * **型の一致（Type Check）** を必須とする。
    * `TargetShape.type === DraggedShape.type` かつ、座標の距離が閾値以内である場合のみ、正解とみなす。
    * 例: 長方形の枠の中に二等辺三角形が入ったとしても、`type`が異なるため吸着してはならない。

2. **生成アルゴリズム (Template-based Generation):**
    * **「完全ランダム座標」は廃止する。**
    * 「ふつう」「むずかしい」モードでは、予め定義された「意味のある形状パターン（Template）」を使用すること。
        * Template例：亀、家、ロケット、大きな四角形など、図形が密集して一つのシルエットを形成する座標データ。
    * ステージ開始時に、テンプレートリストからランダムに1つを選択してターゲットを生成する。
    * ターゲットデータを作成後、それを複製（Deep Copy）し、位置をリセット・シャッフルして「手駒（ドラッグ対象）」とする（**過不足のない1対1対応の保証**）。
    * 「かんたん」モードのみ、従来のグリッド配置または離散的な配置を許容する。

## 使用する図形 (Shape Definitions)

パズル（テンプレート）を構成する要素として、以下の基本図形を使用すること。

* 正方形 (Square)
* 長方形 (Rectangle)
* 平行四辺形 (Parallelogram)
* 正三角形 (Equilateral Triangle)
* 二等辺三角形 (Isosceles Triangle)

## ゲーム全体の流れ

1. 難易度を選択する。
2. 難易度に応じたパズルの型（テンプレート）をロードする。
3. ユーザがD&Dでパズルの図形をはめていく。
4. すべての図形がはまるとステージクリア。
5. 2-4を5回繰り返す。
6. 5回ステージをクリアしたら、ゲームクリアで終了する。

## 難易度とUI仕様

各難易度におけるUI表示（特に枠線）と機能の差異を以下と定義する。

### 共通UI仕様

* **パズル盤面:**
  * 難易度に関わらず、図形を配置すべき「盤面エリア」全体は、背景色や外枠で明確に表示する。
  * ターゲット枠外へのドロップは無効とする。

### かんたん

* **特徴:** 図形の対応が明確にわかる入門モード。
* **ターゲット配置:** 図形同士は離れていてもよい（グリッド配置等）。
* **UI表示:**
  * 盤面の中に、個々の図形の正解位置を示す**「実線または点線の枠線（Visible Border）」を表示する**。
  * ユーザは「形」を見て合わせることができる。
* **機能:** 回転機能なし。
* **初期表示イメージ:** 「かんたん-初期表示.HEIC」準拠。

### ふつう

* **特徴:** シルエットクイズ形式。想像力を働かせる必要がある。
* **ターゲット配置:**
  * **必ず「密集した配置（Dense/Cluster）」であること。**
  * 複数の図形が隙間なく隣接し、全体として一つの大きな形状（亀、家、大きな幾何学模様など）を構成するテンプレートを使用する。
  * バラバラに点在させてはならない（答えが自明になるため）。
* **UI表示:**
  * ターゲット枠の**個別の枠線は一切表示しない（Invisible Individual Borders）**。
  * CSS実装: 個々のターゲットスロットの `border` を除去 (`border: none`) する。
  * ユーザには「大きな盤面（シルエット）」だけが見えており、その中の境界線は見えない。
* **機能:** 回転機能なし。
* **初期表示イメージ:** 「ふつう-初期表示.HEIC」準拠。

### むずかしい

* **特徴:** シルエットクイズ ＋ 回転要素。
* **ターゲット配置:** 「ふつう」と同様、密集したシルエット配置（テンプレート）を使用する。
* **UI表示:** 「ふつう」と同様、個別の枠線は表示しない。
* **機能:** **回転あり（90度単位）**。
  * ターゲットには「正解の角度」が設定される。
  * ユーザは図形をタップして回転させ、角度も一致させないとハマらない。
* **初期表示イメージ:** 「むずかしい-初期表示.HEIC」準拠。

## UX・演出 (UX & Effects)

4歳児の女の子が楽しめるよう、以下の「気持ちよさ」を重視した演出を実装すること。

* **サウンド:**
  * ターゲット枠にはめた際、Nintendo Switchのコントローラー接続音のような**「カチャッ！」という気持ちいい吸着音**を再生する。
* **エフェクト:**
  * 吸着時に、子供が喜ぶエフェクト（キラキラ、バウンドなど）を表示する。
  * ステージクリア、ゲームクリア時には、達成感が持てる派手な演出（紙吹雪、ファンファーレ等）を行う。

## その他遵守すること

* 仕様を示す `docs/specs` 配下の画像ファイル群は `.gitignore` 対象とすること。
  * `かんたん-初期表示.HEIC`
  * `ふつう-初期表示.HEIC`
  * `むずかしい-初期表示.HEIC`
